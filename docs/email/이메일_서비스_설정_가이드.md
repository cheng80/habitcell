# 이메일 서비스 설정 가이드

비밀번호 변경 인증 이메일 발송을 위한 SMTP 설정 방법입니다.

**작성일**: 2026-01-15  
**작성자**: 김택권

---

## ⚠️ 중요: 팀 개발 환경

**각 개발자는 자신의 로컬 환경에 `.env` 파일을 생성해야 합니다.**

- `.env` 파일은 **Git에 커밋하지 않습니다** (보안상 이유)
- 각 팀원은 자신의 이메일 계정과 앱 비밀번호를 사용합니다
- `.env.example` 파일을 참고하여 자신의 `.env` 파일을 만드세요
- 프로덕션 환경에서는 서버 관리자가 별도로 설정합니다

---

## 1. 환경변수 설정 파일 생성

`fastapi` 폴더에 `.env` 파일을 생성하세요.

### 1.1 .env 파일 생성

**⚠️ 각 개발자가 자신의 로컬 환경에 `.env` 파일을 생성해야 합니다.**

`fastapi/.env.example` 파일을 참고하여 `fastapi/.env` 파일을 만드세요:

```bash
cd fastapi
cp .env.example .env
```

**중요 사항:**

- `.env` 파일은 **각 개발자의 컴퓨터에만 존재**합니다
- Git에 커밋하지 마세요 (이미 `.gitignore`에 포함됨)
- 팀원들은 각자 `.env.example`을 복사하여 자신의 설정으로 변경합니다
- 각 팀원은 자신의 이메일 계정과 앱 비밀번호를 사용합니다

### 1.2 .env 파일 내용 수정

`.env` 파일을 열어서 실제 값으로 변경하세요:

```env
# SMTP 서버 호스트 (Gmail 사용 시: smtp.gmail.com)
SMTP_HOST=smtp.gmail.com

# SMTP 포트 (Gmail 사용 시: 587)
SMTP_PORT=587

# 발신자 이메일 주소 (Gmail 계정)
SMTP_USER=your-email@gmail.com

# 발신자 비밀번호 (Gmail 앱 비밀번호)
SMTP_PASSWORD=your-16-digit-app-password

# 발신자 표시 이메일 (받는 사람에게 표시될 이메일)
FROM_EMAIL=noreply@tablenow.com

# 발신자 표시 이름 (받는 사람에게 표시될 이름)
FROM_NAME=Table Now
```

---

## 2. Gmail 앱 비밀번호 생성 방법

Gmail을 사용하는 경우, 앱 비밀번호를 생성해야 합니다.

### 2.1 2단계 인증 활성화 (필수)

**⚠️ 중요**: 앱 비밀번호를 생성하려면 먼저 2단계 인증을 활성화해야 합니다.

1. [Google 계정 설정](https://myaccount.google.com/) 접속
2. 왼쪽 메뉴에서 **"보안"** 클릭
3. **"2단계 인증"** 섹션에서 **"2단계 인증 사용"** 클릭
4. 안내에 따라 2단계 인증 설정 완료
   - 전화번호 인증 또는 Google Authenticator 앱 사용
   - 백업 코드 생성 (안전하게 보관)

**2단계 인증 활성화 확인:**
- 2단계 인증이 활성화되면 "앱 비밀번호" 옵션이 나타납니다
- 2단계 인증이 비활성화되어 있으면 앱 비밀번호를 생성할 수 없습니다

### 2.2 앱 비밀번호 생성

**2단계 인증이 활성화된 후** 다음 단계를 진행하세요:

#### 방법 1: 보안 페이지에서 찾기

1. Google 계정 설정 → **"보안"** → **"2단계 인증"**
2. 페이지를 아래로 스크롤하여 **"앱 비밀번호"** 섹션 찾기
   - 2단계 인증이 활성화되어 있어야 이 섹션이 보입니다
3. **"앱 비밀번호"** 클릭

#### 방법 2: 직접 링크로 이동 (권장)

다음 링크로 직접 이동하세요:

```
https://myaccount.google.com/apppasswords
```

**참고**: 2단계 인증이 활성화되어 있지 않으면 이 페이지에 접근할 수 없습니다.

또는:

1. Google 계정 설정 → **"보안"**
2. **"Google에 로그인"** 섹션에서 **"앱 비밀번호"** 클릭
   - 2단계 인증이 활성화되어 있어야 이 옵션이 보입니다

#### 앱 비밀번호 생성 단계

1. **"앱 선택"** 드롭다운에서 **"기타(맞춤 이름)"** 선택
2. 이름 입력 (예: "Table Now Email Service" 또는 "Table Now SMTP")
3. **"생성"** 버튼 클릭
4. 생성된 **16자리 비밀번호**가 표시됩니다
   - 예: `abcd efgh ijkl mnop` (공백 포함, 실제로는 공백 없이 사용)
5. **비밀번호를 즉시 복사** (한 번만 표시되므로 주의!)
6. `.env` 파일의 `SMTP_PASSWORD`에 붙여넣기
   - 공백은 제거하거나 그대로 사용해도 됩니다 (Gmail이 자동 처리)

**⚠️ 중요 사항:**
- 앱 비밀번호는 **한 번만 표시**되므로 반드시 복사해두세요!
- 복사하지 못한 경우: 삭제 후 다시 생성해야 합니다
- 여러 개 생성 가능: 각 서비스별로 다른 앱 비밀번호를 생성할 수 있습니다

### 2.3 앱 비밀번호 삭제 방법

나중에 앱 비밀번호를 삭제하거나 재생성하려면:

#### 삭제 단계

1. **앱 비밀번호 관리 페이지로 이동**

   - 직접 링크: https://myaccount.google.com/apppasswords
   - 또는: Google 계정 설정 → 보안 → "앱 비밀번호"
   - 또는: Google 계정 설정 → 보안 → "2단계 인증" → 페이지 하단의 "앱 비밀번호"

2. **삭제할 앱 비밀번호 찾기**

   - 생성한 앱 비밀번호 목록이 표시됩니다
   - 각 항목에 이름(예: "Table Now Email Service")과 생성 날짜가 표시됩니다
   - 목록에서 삭제할 앱 비밀번호를 찾습니다

3. **삭제하기**

   **방법 1: 목록에서 직접 삭제**
   - 삭제할 앱 비밀번호 옆의 **삭제 아이콘(휴지통)** 클릭
   - 확인 대화상자에서 **"삭제"** 클릭

   **방법 2: 상세 페이지에서 삭제**
   - 삭제할 앱 비밀번호 항목을 클릭하여 상세 페이지로 이동
   - **"삭제"** 버튼 클릭
   - 확인 대화상자에서 **"삭제"** 클릭

#### 삭제 후 해야 할 일

1. **`.env` 파일 업데이트**
   - 삭제한 앱 비밀번호는 더 이상 사용할 수 없습니다
   - `.env` 파일의 `SMTP_PASSWORD`를 비워두거나
   - 새 앱 비밀번호를 생성하여 교체하세요

2. **서버 재시작**
   - `.env` 파일을 수정한 경우 FastAPI 서버를 재시작해야 합니다

#### 새 앱 비밀번호 생성 (삭제 후 재생성)

삭제한 앱 비밀번호를 다시 사용하려면:
1. 위의 **2.2 앱 비밀번호 생성** 단계를 다시 진행하세요
2. 새로 생성된 16자리 비밀번호를 `.env` 파일에 저장하세요

#### 주의사항

- **삭제 후 복구 불가**: 삭제한 앱 비밀번호는 복구할 수 없습니다
- **즉시 적용**: 삭제하면 해당 앱 비밀번호로는 즉시 로그인할 수 없습니다
- **다른 앱 비밀번호 영향 없음**: 하나를 삭제해도 다른 앱 비밀번호는 계속 사용 가능합니다

#### 보안 팁

- 사용하지 않는 앱 비밀번호는 정기적으로 삭제하세요
- 프로젝트 종료나 이메일 서비스 변경 시 삭제하세요
- 여러 개가 있다면 각각의 용도를 확인하고 불필요한 것은 삭제하세요
- 앱 비밀번호를 잊어버렸거나 분실한 경우: 삭제 후 새로 생성하는 것이 안전합니다

---

## 3. 다른 이메일 서비스 사용하기

Gmail 외의 다른 이메일 서비스를 사용할 수도 있습니다.

### 3.1 네이버 메일

```env
SMTP_HOST=smtp.naver.com
SMTP_PORT=587
SMTP_USER=your-email@naver.com
SMTP_PASSWORD=your-password
```

### 3.2 Outlook/Hotmail

```env
SMTP_HOST=smtp-mail.outlook.com
SMTP_PORT=587
SMTP_USER=your-email@outlook.com
SMTP_PASSWORD=your-password
```

### 3.3 SendGrid (전문 이메일 서비스)

```env
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASSWORD=your-sendgrid-api-key
```

---

## 4. 설정 확인

### 4.1 .env 파일 위치 확인

`.env` 파일은 반드시 `fastapi` 폴더 안에 있어야 합니다:

```
fastapi/
  ├── .env          ← 여기에 위치
  ├── app/
  │   ├── main.py
  │   └── ...
  └── ...
```

### 4.2 .gitignore 확인

`.env` 파일은 절대 Git에 커밋하지 마세요! `.gitignore`에 포함되어 있는지 확인하세요:

```gitignore
# 환경변수 파일
.env
.env.local
.env.*.local
```

---

## 5. 테스트

### 5.1 서버 실행

```bash
cd fastapi
python3 -m uvicorn app.main:app --reload
```

### 5.2 비밀번호 변경 테스트

1. Flutter 앱 실행
2. 회원 정보 수정 화면으로 이동
3. "비밀번호 변경" 버튼 클릭
4. "인증 코드 발송" 버튼 클릭
5. 등록된 이메일로 인증 코드가 발송되는지 확인

---

## 6. 문제 해결

### 6.1 "이메일 서비스가 설정되지 않았습니다" 오류

- `.env` 파일이 `fastapi` 폴더에 있는지 확인
- `.env` 파일의 변수명이 정확한지 확인 (대문자)
- 서버를 재시작했는지 확인

### 6.2 "이메일 발송에 실패했습니다" 오류

- Gmail 사용 시: 앱 비밀번호를 사용하고 있는지 확인 (일반 비밀번호 X)
- 2단계 인증이 활성화되어 있는지 확인
- SMTP_HOST, SMTP_PORT가 올바른지 확인
- 방화벽이나 네트워크 설정 확인

### 6.3 Gmail "보안 수준이 낮은 앱의 액세스" 오류

- Google 계정 설정 → 보안 → "보안 수준이 낮은 앱의 액세스" 허용
- 또는 앱 비밀번호 사용 (권장)

---

## 변경 이력

- **2026-01-15**: 초기 문서 작성 (작성자: 김택권)
  - Gmail 앱 비밀번호 생성 방법 안내
  - .env 파일 설정 방법 안내
  - 다른 이메일 서비스 사용 방법 추가
  - 앱 비밀번호 삭제 방법 추가
  - 직접 링크로 이동하는 방법 추가 (방법 2)

- **2026-01-15**: 문서 보완 (작성자: 김택권)
  - 2단계 인증 활성화 후 앱 비밀번호 생성 단계 명확화
  - 앱 비밀번호 생성 단계 상세 설명 추가 (공백 처리, 복사 주의사항 등)
  - 앱 비밀번호 삭제 방법 상세 설명 추가 (삭제 단계, 삭제 후 조치사항, 재생성 방법)
  - 2단계 인증 활성화 확인 방법 추가
